<!doctype html><html><head><title>Calling type · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-rpc/invoke-type/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-rpc/invoke-type/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Calling type</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-rpc/invoke-type/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><p>SOFARPC provides a variety of calling types under the Bolt protocol to meet different scenarios.</p><h3 id=synchronous>Synchronous</h3><p>In the synchronous calling type, after the client initiates a call, it will wait for the server to return the result and then perform subsequent operations. This is the default calling type of SOFARPC.</p><h3 id=asynchronous>Asynchronous</h3><p>In the asynchronous calling type, after the client initiates a call, it will not wait for the result from the server but continue to execute the subsequent business logic. The result returned by the server will be cached by SOFARPC. When the client needs the result, it can call the API to get the result. To set a service to be asynchronous, you can configure the <code>type</code> attribute in the corresponding usage mode:</p><h4 id=xml>XML</h4><p>In the XML mode, set the <code>type</code> attribute of the <code>&lt;sofa:global-attrs&gt;</code> tag to <code>future</code>:</p><pre><code class=language-xml>&lt;sofa:reference interface=&quot;com.example.demo.SampleService&quot; id=&quot;sampleService&quot;&gt;
    &lt;sofa:binding.bolt&gt;
        &lt;sofa:global-attrs type=&quot;future&quot;/&gt;
    &lt;/sofa:binding.bolt&gt;
&lt;/sofa:reference&gt;
</code></pre><h4 id=annotation>Annotation</h4><p>In Annotation mode, set the <code>invokeType</code> attribute of <code>@SofaReferenceBinding</code> to <code>future</code>:</p><pre><code class=language-java>@SofaReference(binding = @SofaReferenceBinding(bindingType = &quot;bolt&quot;, invokeType = &quot;future&quot;))
private SampleService sampleService;
</code></pre><h4 id=api-in-spring-environment>API in Spring environment</h4><p>When using the API in Spring environment, you just need to set the <code>type</code> attribute of <code>BoltBindingParam</code>:</p><pre><code class=language-java>BoltBindingParam boltBindingParam = new BoltBindingParam();
boltBindingParam.setType(&quot;future&quot;);
</code></pre><h4 id=api-in-non-spring-environment>API in non-Spring environment</h4><p>When using the bare API of SOFARPC in a non-Spring environment, you just need to set the <code>invokeType</code> attribute of <code>ConsumerConfig</code>:</p><pre><code class=language-java>ConsumerConfig&lt;SampleService&gt; consumerConfig = new ConsumerConfig&lt;SampleService&gt;()
    .setInterfaceId(SampleService.class.getName())
    .setRegistry(registryConfig)
    .setProtocol(&quot;bolt&quot;)
    .setInvokeType(&quot;future&quot;);
</code></pre><h4 id=get-the-calling-result>Get the calling result</h4><p>Currently, there are two ways to get the result of an asynchronous call:</p><h5 id=get-result-directly>Get result directly</h5><p>You can directly get the result of an asynchronous call in the following way:</p><pre><code class=language-java>String result = (String)SofaResponseFuture.getResponse(0, true);
</code></pre><p>The first parameter is the timeout period for getting the result, and the second parameter indicates whether to clear the result in the thread context.</p><h5 id=get-jdk-native-future>Get JDK native Future</h5><p>You can get the JDK native Future object in the following way, and then call the Future object from anywhere to get the result:</p><pre><code class=language-java>Future future = SofaResponseFuture.getFuture(true);
</code></pre><p>The first parameter indicates whether to clear the result in the thread context.</p><h3 id=callback>Callback</h3><p>By using the callback type of the SOFARPC Bolt protocol, SOFARPC doesn&rsquo;t need to wait for the result after initiating a call. After the client receives the result returned from the server, it can automatically call back a callback interface implemented by the user.</p><p>To use the callback type of the SOFARPC Bolt protocol, you first need to implement a callback interface, and set the callback interface in the corresponding configuration, and then set the calling type to <code>callback</code>.</p><h4 id=implement-callback-interface>Implement callback interface</h4><p>SOFARPC provides a callback interface <code>com.alipay.sofa.rpc.core.invoke.SofaResponseCallback</code>, which you needs to first implement in order to use the callback type of SOFARPC Bolt protocol. This interface provides three methods:</p><ul><li><code>onAppResponse</code>: SOFARPC will call back this method when the client receives a normal return from the server.</li><li><code>onAppException</code>: SOFARPC will call back this method when the client receives an exception response from the server.</li><li><code>onSofaException</code>: SOFARPC will call back this method when there are some errors in SOFARPC itself, such as routing errors.</li></ul><h4 id=set-the-callback-interface>Set the callback interface</h4><p>After implementing the callback interface, you need to set the implementation class in the corresponding service reference configuration and set the calling type to callback.</p><p>SOFARPC provides two ways to set the callback interface, namely <code>Callback Class</code> and <code>Callback Ref</code>. Callback Class directly sets the class name of the callback, and SOFARPC generates an instance of the callback class by calling the default constructor of the callback class. While Callback Ref is to directly provide the instance of the callback class.</p><h5 id=xml-1>XML</h5><p>If the service is referenced via XML, set the <code>type</code> attribute of the <code>&lt;sofa:global-attrs&gt;</code> tag to <code>callback</code> and set the <code>callback-ref</code> or <code>callback-class</code> attribute:</p><pre><code class=language-xml>&lt;bean id=&quot;sampleCallback&quot; class=&quot;com.example.demo.SampleCallback&quot;/&gt;
&lt;sofa:reference interface=&quot;com.example.demo.SampleService&quot; id=&quot;sampleService&quot;&gt;
    &lt;sofa:binding.bolt&gt;
        &lt;sofa:global-attrs type=&quot;callback&quot; callback-ref=&quot;sampleCallback&quot;/&gt;
    &lt;/sofa:binding.bolt&gt;
&lt;/sofa:reference&gt;
</code></pre><p>In the XML mode, the value of <code>callback-ref</code> should be the bean name of the callback class.</p><h5 id=annotation-1>Annotation</h5><p>If the service is referenced via Annotation, set the <code>invokeType</code> attribute of the <code>@SofaReferenceBinding</code> annotation to <code>callback</code> and set the <code>callbackClass</code> or <code>callbackRef</code> attribute:</p><pre><code class=language-java>@SofaReference(binding = @SofaReferenceBinding(bindingType = &quot;bolt&quot;,
            invokeType = &quot;callback&quot;,
            callbackRef = &quot;sampleCallback&quot;))
private SampleService sampleService;
</code></pre><p>In the Annotation mode, the value of the <code>callbackRef</code> should be the bean name of the callback class.</p><h5 id=api-in-spring-environment-1>API in Spring Environment</h5><p>If you use the API in Spring or Spring Boot environment, set the <code>type</code> attribute of <code>BoltBindingParam</code> to <code>callback</code> and set the <code>callbackClass</code> or <code>callbackRef</code> attribute:</p><pre><code class=language-java>BoltBindingParam boltBindingParam = new BoltBindingParam();
boltBindingParam.setType(&quot;callback&quot;);
boltBindingParam.setCallbackClass(&quot;com.example.demo.SampleCallback&quot;);
</code></pre><h5 id=api-in-non-spring-environment-1>API in non-Spring environment</h5><p>If you use SOFARPC bare API in non-Spring environment, call <code>setInvokeType</code> to set the type to <code>callback</code> and call <code>setOnReturn</code> to set the callback class:</p><pre><code class=language-java>ConsumerConfig&lt;SampleService&gt; consumerConfig = new ConsumerConfig&lt;SampleService&gt;()
    .setInterfaceId(SampleService.class.getName())
    .setRegistry(registryConfig)
    .setProtocol(&quot;bolt&quot;)
    .setInvokeType(&quot;callback&quot;)
    .setOnReturn(new SampleCallback());
</code></pre><h5 id=set-the-callback-interface-at-call-level>Set the callback interface at call level</h5><p>In addition to setting the callback interface at service level, you can also set the callback interface at call level, as follows:</p><pre><code class=language-java>RpcInvokeContext.getContext().setResponseCallback(new SampleCallback());
</code></pre><h3 id=oneway>Oneway</h3><p>When the client does not care about the result returned from the server after sending the request, it can use the oneway calling type. In this type, null is returned immediately after the call is initiated, and the client ignores the result returned from the server.</p><p>To use the oneway type, you only need to set the calling type to <code>oneway</code>, which is the same as setting the calling type to <code>future</code> or <code>callback</code>. You can refer to the preceding settings.</p><p>Note: Since the oneway calling type returns immediately, all timeout settings are invalid in the case of oneway.</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>