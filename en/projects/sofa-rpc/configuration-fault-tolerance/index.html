<!doctype html><html><head><title>Fault tolerance configuration · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-rpc/configuration-fault-tolerance/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-rpc/configuration-fault-tolerance/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Fault tolerance configuration</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-rpc/configuration-fault-tolerance/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><p>Fault tolerance automatically monitors the RPC calls, degrades the weight of the failed node, and recovers the weight when the node restored to normal. The bolt protocol is currently supported.</p><p>In SOFABoot, you only need to configure fault tolerance parameters to <code>application.properties</code>. You can select not to configure all parameters but only configure the parameters that you care about. Then, the remaining parameters will take the default values. Note that <code>rpc.aft.regulation.effective</code> is a global switch for this function. If it is off, the function will not work and other parameters will not take effect.</p><table><thead><tr><th align=left>Attribute</th><th align=left>Description</th><th align=left>Default value</th></tr></thead><tbody><tr><td align=left>timeWindow</td><td align=left>Time window size: the period in which statistics are calculated.</td><td align=left>10s</td></tr><tr><td align=left>leastWindowCount</td><td align=left>Minimum number of calls in the time window: Only data that has reached this minimum value in the time window will be added in calculation and control.</td><td align=left>10 times</td></tr><tr><td align=left>leastWindowExceptionRateMultiple</td><td align=left>Degradation ratio of the exception rate in the time window to the average exception rate of the service: When calculating the statistical information, the average exception rate of all valid call IPs of the service is calculated. If the exception rate of an IP is greater than or equal to the lowest ratio, the IP will be degraded.</td><td align=left>6 times</td></tr><tr><td align=left>weightDegradeRate</td><td align=left>Degradation ratio: The rate of degradation of an address when it is degraded.</td><td align=left><sup>1</sup>&frasl;<sub>20</sub></td></tr><tr><td align=left>weightRecoverRate</td><td align=left>Recovery ratio: The recovery ratio of the address when it is weighted.</td><td align=left>2 times</td></tr><tr><td align=left>degradeEffective</td><td align=left>Degradation switch: If the application turns on this switch, it will degrade the address that matches the degradation criteria; otherwise, only the log will be printed.</td><td align=left>false (off)</td></tr><tr><td align=left>degradeLeastWeight</td><td align=left>Degradation minimum weight: If the address weight is degraded to the weight less than this minimum weight, the minimum weight will be used.</td><td align=left>1</td></tr><tr><td align=left>degradeMaxIpCount</td><td align=left>Maximum number of IPs for degradation: The number of IPs in the same service that have been degraded cannot exceed this value.</td><td align=left>2</td></tr><tr><td align=left>regulationEffective</td><td align=left>Global switch: If the switch is turned on by the application, the entire standalone fault tolerance function will be turned on; otherwise, this function will not be used at all.</td><td align=left>false (off)</td></tr></tbody></table><ul><li><p>Example</p><pre><code>Com.alipay.sofa.rpc.aft.time.window=20
Com.alipay.sofa.rpc.aft.least.window.count=30
Com.alipay.sofa.rpc.aft.least.window.exception.rate.multiple=6
Com.alipay.sofa.rpc.aft.weight.degrade.rate=0.5
Com.alipay.sofa.rpc.aft.weight.recover.rate=1.2
Com.alipay.sofa.rpc.aft.degrade.effective=ture
Com.alipay.sofa.rpc.aft.degrade.least.weight=1
Com.alipay.sofa.rpc.aft.degrade.max.ip.count=2
Com.alipay.sofa.rpc.aft.regulation.effective=true
</code></pre><p>As configured above, the fault tolerance function and degradation switch are enabled. When a node fails too many times, its weight is degraded, and during recovery, the weight will be restored. The node healthy is measured every 20s, and the nodes called for more than 30 times in 20s are recognized as calculation data. If the exception rate of a single node exceeds 6 times of the average exception rate of all nodes, the node will be degraded, and the degradation ratio is 0.5. The weight can be degraded to a minimum of 1. If the exception rate of a single node is less than 6 times of the average exception rate, the node weight will be restored, and the recovery ratio is 1.2. In a single service, 2 IPs can be degraded at most.</p></li></ul></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>