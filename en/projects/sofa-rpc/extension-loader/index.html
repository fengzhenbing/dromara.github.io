<!doctype html><html><head><title>Extension mechanism · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-rpc/extension-loader/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-rpc/extension-loader/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Extension mechanism</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-rpc/extension-loader/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><h1 id=extensionloader>ExtensionLoader</h1><p>To ensure that all steps of SOFARPC have sufficient scalability, SOFARPC defines a very flexible extension mechanism in which all extension implementations are equal.</p><p>This mechanism is very useful for both SOFARPC developers and users. SOFARPC abstracts itself into multiple modules which have no explicit dependencies on each other and interact via SPI.</p><p>This extension mechanism abstracts the interaction method of SPI. If you have read the documents about Filter and Router, you may have such experience.</p><p>The following sections introduce how to extend through the SPI interaction method.</p><p>SOFARPC provides the capabilities of ExtensionLoader.</p><h2 id=design-extension-points>Design extension points</h2><p>SOFARPC defines an annotation <code>@Extensible</code>, which is on the interface or abstract class to identify that the class is an extension point. Namely, it informs SOFARPC that the class is extensible and SOFARPC needs to find the implementation of the extension point. In addition, the annotation defines the file name of the implementation class and whether the class is a singleton.</p><pre><code class=language-java>@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ ElementType.TYPE })
public @interface Extensible {

    /**
     * Specify the name of the custom extension file, which is the full class name by default
     *
     * @return Custom extension file name
     */
    String file() default &quot;&quot;;

    /**
     * Whether the extension class uses a singleton, yes by default
     *
     * @return Whether to use a singleton
     */
    boolean singleton() default true;

    /**
     * Whether the extension class needs to be encoded, not by default
     *
     * @return Whether to encode
     */
    boolean coded() default false;
}
</code></pre><p>SOFARPC also defines the <code>@Extension</code> annotation, which indicates an extension implementation class. It also defines the name that the extension point uses when looking for an extension implementation in the file.</p><pre><code class=language-java>@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ ElementType.TYPE })
public @interface Extension {
    /**
     * Extension point name
     *
     * @return Extension point name
     */
    String value();

    /**
     * Extension point coding, not required by default; it is required when the interface needs to be encoded
     *
     * @return Extension point encoding
     * @see Extensible#coded()
     */
    byte code() default -1;

    /**
     * Priority sorting, not required by default, the larger number, the higher priority
     *
     * @return Sort
     */
    int order() default 0;

    /**
     * Whether to override other extensions with low {@link #order()}
     *
     * @return Whether to override other low-order extensions
     * @since 5.2.0
     */
    boolean override() default false;

    /**
     * Exclude other extensions, namely exclude other extensions with low {@link #order()}
     *
     * @return Excludes other extensions
     * @since 5.2.0
     */
    String[] rejection() default {};
}
</code></pre><h2 id=add-extension-point>Add extension point</h2><ol><li>Define extension points.</li></ol><pre><code class=language-java>    @Extensible
    public interface Person {

        void getName();
    }
</code></pre><ol><li>Define the extension implementation.</li></ol><pre><code class=language-java>    @Extension(&quot;A&quot;)
    public class PersonA implements Person{
        @Override
        public void getName() {
            System.out.println(&quot;li wei&quot;);
        }
    }
</code></pre><ol><li>Compile the extension description file <code>META-INF/services/sofa-rpc/com.alipay.sofa.rpc.extension.Person</code>. The file content is as follows:</li></ol><pre><code class=language-plain>A=com.alipay.sofa.rpc.extension.PersonA
</code></pre><ol><li>Load the extension points and get the extension implementation class.</li></ol><pre><code class=language-java>Person person = ExtensionLoaderFactory.getExtensionLoader(Person.class).getExtension(&quot;A&quot;);
</code></pre><h2 id=existing-extension-points>Existing extension points</h2><p>If you want to extend the function of each built-in extension point in SOFARPC, you can directly implement the existing extensions and configure the extended file.</p><p>The existing extension points are as follows:</p><table><thead><tr><th align=left>Interface name</th><th align=left>Definition</th><th align=left>Remarks</th><th align=left>Built-in implementation</th></tr></thead><tbody><tr><td align=left>com.alipay.sofa.rpc.client.Client</td><td align=left>Client</td><td align=left></td><td align=left>Failover, Failfast</td></tr><tr><td align=left>com.alipay.sofa.rpc.client.ConnectionHolder</td><td align=left>Connection Holder</td><td align=left></td><td align=left>AllConnect (all connections)</td></tr><tr><td align=left>com.alipay.sofa.rpc.client.AddressHolder</td><td align=left>Address Holder</td><td align=left></td><td align=left>Single group, multiple groups</td></tr><tr><td align=left>com.alipay.sofa.rpc.client.LoadBalancer</td><td align=left>Load balancer</td><td align=left></td><td align=left>Random, polling, least concurrency, consistency hash, native priority</td></tr><tr><td align=left>com.alipay.sofa.rpc.client.Router</td><td align=left>Router</td><td align=left></td><td align=left></td></tr><tr><td align=left>com.alipay.sofa.rpc.codec.Compressor</td><td align=left>Compressor</td><td align=left></td><td align=left>snappy</td></tr><tr><td align=left>com.alipay.sofa.rpc.codec.Serializer</td><td align=left>Serializer</td><td align=left></td><td align=left>Java, Hessian, PB</td></tr><tr><td align=left>com.alipay.sofa.rpc.filter.Filter</td><td align=left>Interceptor</td><td align=left></td><td align=left></td></tr><tr><td align=left>com.alipay.sofa.rpc.protocol.Protocol</td><td align=left>Protocol decoder</td><td align=left></td><td align=left>Bolt, Dubbo, Rest</td></tr><tr><td align=left>com.alipay.sofa.rpc.protocol.ProtocolDecoder</td><td align=left>Protocol encoder</td><td align=left></td><td align=left>Bolt</td></tr><tr><td align=left>com.alipay.sofa.rpc.protocol.ProtocolEncoder</td><td align=left>Protocol Encoding</td><td align=left></td><td align=left>bolt</td></tr><tr><td align=left>com.alipay.sofa.rpc.protocol.TelnetHandler</td><td align=left>Telnet response</td><td align=left></td><td align=left>Version, help, ls</td></tr><tr><td align=left>com.alipay.sofa.rpc.proxy.Proxy</td><td align=left>Proxy class</td><td align=left></td><td align=left>Java, Javassist</td></tr><tr><td align=left>com.alipay.sofa.rpc.registry.Registry</td><td align=left>Registry Center</td><td align=left></td><td align=left>ZooKeeper</td></tr><tr><td align=left>com.alipay.sofa.rpc.server.Server</td><td align=left>Server implementation</td><td align=left></td><td align=left>Bolt, Rest</td></tr><tr><td align=left>com.alipay.sofa.rpc.transport.ClientTransport</td><td align=left>Client persistent connection implementation</td><td align=left></td><td align=left>Netty</td></tr><tr><td align=left>com.alipay.sofa.rpc.transport.ServerTransport</td><td align=left>Server persistent connection implementation</td><td align=left></td><td align=left>Netty</td></tr></tbody></table></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>