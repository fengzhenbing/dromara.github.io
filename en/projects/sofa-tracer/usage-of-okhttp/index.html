<!doctype html><html><head><title>OkHttp Integration · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-tracer/usage-of-okhttp/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-tracer/usage-of-okhttp/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>OkHttp Integration</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-tracer/usage-of-okhttp/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><h1 id=okhttp-integration>OkHttp Integration</h1><p>In this document will demonstrate how to use SOFATracer to track of OkHttp, this example <a href=https://github.com/sofastack-guides/sofa-tracer-guides/tree/sofaboot-2.x/tracer-sample-with-okhttp>address</a>.</p><p>Assuming you have built a simple Spring Web project based on SOFABoot, Then you can be operated by the following steps:</p><h2 id=dependency-introduction>Dependency introduction</h2><pre><code class=language-xml>&lt;!-- SOFATracer dependency --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;tracer-sofa-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- okhttp dependency --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;
    &lt;artifactId&gt;okhttp&lt;/artifactId&gt;
    &lt;version&gt;3.12.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h2 id=project-configuration>Project Configuration</h2><p>Then, add the parameters to be used by SOFATracer in the project&rsquo;s <code>application.properties</code> file, including <code>spring.application.name</code> that indicates the name of the current application and <code>logging.path</code> that specifies the log output directory.</p><pre><code class=language-properties># Application Name
spring.application.name=HttpClientDemo
# logging path
logging.path=./logs
# port
server.port=8081
</code></pre><h2 id=add-a-controller-that-provides-restful-services>Add a Controller that provides RESTful services</h2><p>In the project, provide a simple Controller, for example:</p><pre><code class=language-java>@RestController
public class SampleRestController {

    private final AtomicLong counter = new AtomicLong(0);

    /**
     * Request http://localhost:8081/okhttp?name=sofa
     * @param name name
     * @return Map of Result
     */
    @RequestMapping(&quot;/okhttp&quot;)
    public Map&lt;String, Object&gt; greeting(@RequestParam(value = &quot;name&quot;, defaultValue = &quot;okhttp&quot;) String name) {
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;count&quot;, counter.incrementAndGet());
        map.put(&quot;name&quot;, name);
        return map;
    }
}
</code></pre><h2 id=construct-okhttp-to-initiate-a-call-to-the-restful-service-above>Construct OkHttp to initiate a call to the RESTful service above</h2><p>The code example is as follows:</p><ul><li>Construct the OkHttp Client instance:</li></ul><pre><code class=language-java>OkHttpClientInstance httpClient = new OkHttpClientInstance();
String httpGetUrl = &quot;http://localhost:8081/okhttp?name=sofa&quot;;
String responseStr = httpClient.executeGet(httpGetUrl);
</code></pre><h2 id=run>Run</h2><p>Start the SOFABoot app and see the log in the console as follows:</p><pre><code>2019-04-12 13:38:09.896  INFO 51193 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2019-04-12 13:38:09.947  INFO 51193 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8081 (http)
2019-04-12 13:38:09.952  INFO 51193 --- [           main] c.a.s.t.e.okhttp.OkHttpDemoApplication   : Started OkHttpDemoApplication in 3.314 seconds (JVM running for 4.157)
</code></pre><p>When there is a log similar to the following, the call to OkHttp is successful:</p><pre><code>2019-04-12 13:38:10.205  INFO 51193 --- [           main] c.a.s.t.e.okhttp.OkHttpDemoApplication   : Response is {&quot;count&quot;:1,&quot;name&quot;:&quot;sofa&quot;}
</code></pre><h2 id=view-log>View log</h2><p>In the <code>application.properties</code>, the log printing directory we configured is <code>./logs</code>, which is the root directory of the current application (we can configure it based on actual situation). In the root directory, you can see log files in the structure similar to the followings:</p><pre><code>./logs
├── spring.log
└── tracelog
    ├── okhttp-digest.log
    ├── okhttp-stat.log
    ├── spring-mvc-digest.log
    ├── spring-mvc-stat.log
    ├── static-info.log
    └── tracer-self.log
</code></pre><p>In the example, you can see logs like the following in okhttp-digest.</p><pre><code class=language-json>{&quot;time&quot;:&quot;2019-04-12 13:38:10.187&quot;,&quot;local.app&quot;:&quot;OkHttpDemo&quot;,&quot;traceId&quot;:&quot;0a0fe85a1555047489980100151193&quot;,&quot;spanId&quot;:&quot;0&quot;,&quot;request.url&quot;:&quot;http://localhost:8081/okhttp?name=sofa&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:0,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:207,&quot;current.thread.name&quot;:&quot;main&quot;,&quot;remote.app&quot;:&quot;&quot;,&quot;baggage&quot;:&quot;&quot;}
</code></pre></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>