<!doctype html><html><head><title>Extensions · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-acts/usage-api/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-acts/usage-api/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Extensions</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-acts/usage-api/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><h2 id=customize-different-engine-stages>Customize different engine stages</h2><p>You can rewrite APIs provided by ActsTestBase in the test script or in the base class.</p><ol><li>Rewrite the prepare, execute, check, and clear actions. For example, you can add some actions before or after super.prepare().</li><li>Rewrite the process method. You can add some actions before or after super.process() to reorchestrate the entire script. For example, you can add some personalized steps in the existing clear &gt; prepare &gt; execute &gt; check process.</li><li>Rewrite beforeActsTest and afterActsTest to add some personalized actions before or after the running of each test case, such as preparing the context and refreshing the cache.</li></ol><h2 id=parameterization>Parameterization</h2><p>In response expectation and database expectation data, you can use <code>$Variable name</code> to define a value as a variable. You can set values of the variable in the test script.
Supported scope: request parameters, responses, and database table fields. Supported types: Currently, only string parameterization is supported.</p><p>Usage:</p><p>(1) Add <code>$</code> before a value to define it as a variable in the interface.</p><p><img src=variables.png alt=Variables></p><p>(2) Assign values to the variables in the test script.</p><pre><code class=language-java>@Override
public void beforeActsTest(ActsRuntimeContext actsRuntimeContext) {
    actsRuntimeContext.paramMap.put(&quot;roleId&quot;, &quot;123&quot;);
    actsRuntimeContext.refreshDataParam();
}
</code></pre><p>When you write the database expectation, you can use the equal sign <code>=</code> to assign a value to the variable. This indicates that the value is a query result, and subsequent tables can use this variable as the value.</p><p><img src=assign-value.png alt="Assign value"></p><p><img src=variable-value.png alt="Variable value"></p><p>Assume that the interface will insert data into two tables.</p><table><thead><tr><th align=left>id_A</th><th align=left>value_A</th></tr></thead><tbody><tr><td align=left>123</td><td align=left>abc</td></tr></tbody></table><table><thead><tr><th align=left>id_B</th><th align=left>value_B</th></tr></thead><tbody><tr><td align=left>abc</td><td align=left>efg</td></tr></tbody></table><p>When you query these two tables, first query for value_A based on id_A in Table A that is returned by the interface. Then use value_A as a condition for the query in Table B. You can set the values as follows in the plug-in.</p><table><thead><tr><th align=left>Field</th><th align=left>Flag</th><th align=left>Value</th></tr></thead><tbody><tr><td align=left>id_A</td><td align=left>C</td><td align=left>$param1</td></tr><tr><td align=left>value_A</td><td align=left>Y</td><td align=left>=param2</td></tr></tbody></table><table><thead><tr><th align=left>Field</th><th align=left>Flag</th><th align=left>Value</th></tr></thead><tbody><tr><td align=left>id_B</td><td align=left>C</td><td align=left>$param2</td></tr><tr><td align=left>value_B</td><td align=left>Y</td><td align=left>efg</td></tr></tbody></table><p>Operation description:</p><ol><li><code>=param2</code> and <code>$param2</code> indicate that the ACTS framework will first query for value_A in Table A, and then <code>select from B where id_B = value_A</code> to obtain the property value of id_B in Table B.</li><li><code>$param1</code> indicates that you can assign a value to id_A in the code, for example:</li></ol><pre><code class=language-java>actsRuntimeContext.paramMap.put(&quot;param1&quot;,&quot;123&quot;);
</code></pre><p>This snippet assigns the value 123 to the variable param1. You can write this snippet to beforeActsTest in the test script to make the ACTS framework query table A before assigning the value 123 to id_A.</p><h2 id=componentization>Componentization</h2><p><strong>Currently, only string componentization is supported.</strong></p><p>If a property is a dynamically generated string, for example, some IDs. You can use the at sign <code>@</code> to call a component to generate this property. The component must be placed in the component package at the same level as the test module, namely: <code>com.corpname.appname.acts.component</code> (appname is the name of the system, and corpname is the name of the company, for example, Alipay).</p><pre><code class=language-java>public class MyComponent {
    @TestComponent(id = &quot;test&quot;)
    public String test(String param) {
        return param+&quot;123&quot;;
    }
}
</code></pre><p>Then use <code>acts-config.properties</code> to declare the parameter components to make them take effect. Use English commas <code>,</code> to separate multiple components. Avoid unnecessary trailing spaces.</p><pre><code class=language-plain>param_components=IdGenerateComponent,NoGenerateComponent
</code></pre><p><img src=auto-replace.png alt="Automatic value replacement"></p><p>As shown in the preceding figure, the value of alis_value is <code>@test? param=123</code>. When ACTS runs the test case, it automatically replaces the value of alis_value.</p><p>Component IDs must be unique. Otherwise, only the first component (among multiple components with identical Ids) is called. If a non-parameter component method is declared, you can simply annotate this method by using <code>@test</code>. In addition, component arguments can be passed in the form of variables. For example, in <code>@test? param=$id</code>, $id is replaced with the actual value when the test case is run.</p><p>Component parameters can also be called in the test script:</p><pre><code class=language-java>ActsComponentUtil.run(&quot;@test?param=123&quot;);
</code></pre><p>If a custom component has multiple parameters, use ampersands <code>&amp;</code> to separate the parameters, for example, <code>@test? param1=xxx&amp;param2=yyy</code></p><h2 id=database-utilities>Database utilities</h2><h3 id=1-specify-a-datasource-for-db-table-access>1. Specify a datasource for DB table access</h3><p>The ActsDBUtils class of ACTS supports database table access with specified data sources for personalized database operations. For example, assume that a database table has a data record that is neither preparation data nor validation data and must be deleted or updated after the test case is run. In this case, you need to use this utility to operate on the database data.</p><p><strong>Pre-use configuration</strong></p><p>To use a specified datasource, you need to first configure the datasource in the <code>acts-config.properties</code> file as shown in the following example.</p><pre><code class=language-plain>datasource_bean_name_exampleDataSource=com.alipay.example.dal;exampleDataSource

#The overall configuration follows this format: datasource_bean_name_xxx(datasource name)=yyy(module name of the datasource);xxx(datasource name)
</code></pre><p><strong>Methods for specifying a datasource</strong></p><p>Description of the ActsDBUtils utility class method for specifying a datasource:</p><pre><code class=language-java>public static int getUpdateResultMap(String sql,String tableName,String dbConfigKey);
</code></pre><p>You can use this method to specify a datasource for table addition, deletion, and edit. In this method, sql is a standard SQL statement, tableName is the logical table name, and dbConfigKey is the logical datasource configuration of the DB table.
The datasource is identical to the datasource name that you have configured in <code>acts-config.properties</code>.</p><pre><code class=language-java>public static List&lt;Map&lt;String, Object&gt;&gt; getQueryResultMap(String sql, String tableName,String dbConfigKey);
</code></pre><p>You can use this method to specify a datasource for table query. These two methods are atomic database table operations. If you have other database operation requirements, you can encapsulate additional operations upon these two operations.</p><h3 id=2-access-database-tables-without-specifying-a-datasource>2. Access database tables without specifying a datasource</h3><p>In this method, the ACTS framework searches the datasource by table name. The steps for using this utility method are as follows:</p><p><strong>Pre-use configuration</strong></p><pre><code class=language-plain>datasource_bundle_name=com.alipay.example.common.dal
ds_exampleDataSource=table1,tabal2

#The overall configuration follows this format
#datasource_bundle_name=module name of the datasource
#ds_datasource name=logical table name of this datasource
</code></pre><p><strong>Methods without specifying a datasource</strong></p><pre><code class=language-java>public static int getUpdateResultMap(String sql, String tableName);
</code></pre><p>You can use this method for table addition, deletion, and edit without specifying a datasource. In this method, sql is a standard SQL statement, and tableName is the logical table name.</p><pre><code class=language-java>public static List&lt;Map&lt;String, Object&gt;&gt; getQueryResultMap(String sql, String tableName);
</code></pre><p>You can use this method for table query without specifying a datasource.</p><h2 id=annotation-extensions-in-different-acts-stages>Annotation extensions in different ACTS stages</h2><p>You can annotate custom methods to perform personalized operations in different stages indicated by the annotation.</p><pre><code class=language-java>@BeforeClean
public void beforeClean(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute before cleaning!&quot;) ;
}

@AfterClean
public void afterClean(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute after cleaning!&quot;) ;
}

@BeforePrepare
public void beforePrepare(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute before preparation!&quot;) ;
}

@AfterPrepare
public void afterPrepare(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute after preparation!&quot;) ;
}

@BeforeCheck
public void beforeCheck(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute before check!&quot;) ;
}

@AfterCheck
public void afterCheck(ActsRuntimeContext actsRuntimeContext) {
    System.out.println(&quot;Execute after check!&quot;) ;
}
</code></pre><p>You can simply annotate the method that you want to execute. Arguments of annotated methods must be consistent with those in the preceding example. ActsRuntimeContext is automatically passed to the annotated method for use by the ACTS framework.</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>