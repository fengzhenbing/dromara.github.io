<!doctype html><html><head><title>Package into Ark Plugin · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-boot/sofa-ark-ark-plugin-demo/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-boot/sofa-ark-ark-plugin-demo/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Package into Ark Plugin</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-boot/sofa-ark-ark-plugin-demo/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><h2 id=introduction>Introduction</h2><p>This sample project demonstrates how to use Maven plugins to package a general Java project into an <code>Ark plugin</code> that meets the standard specifications.</p><h2 id=background>Background</h2><p>In actual development, dependency conflicts often occur. Suppose we have developed a class library named <code>sample-lib</code>, and it might conflict with the existing dependencies when the business application is imported. At this point, we hope the library can be isolated from other business dependencies, without negotiating with each other over dependency package versions. <code>Ark Plugin</code> is exactly the result of our best practice under this demand background. It runs on top of the <code>Ark Container</code>, which is loaded by a container. Any <code>Ark Plugin</code> is loaded by a separate ClassLoader to be isolated from each other. There are four concepts of <code>Ark Plugin</code>:
* Import class: When the plugin starts up, a plugin used to export the class is first delegated to load the class. If that fails, it will attempt to load from inside this plugin;</p><ul><li><p>Export class: If the class has been imported by other plugins, it will be first loaded from this plugin;</p></li><li><p>Import resource: When the plugin is searching for resources, a plugin used to export the class is first delegated to load the class. If that fails, it will attempt to load from inside this plugin.</p></li><li><p>Export resource: If the resource has been imported by other plugins, it will be first loaded from this plugin;</p></li></ul><blockquote><p><a href=../sofa-ark-ark-plugin>Refer to the plugin specifications for more details</a></p></blockquote><h2 id=tools>Tools</h2><p>Upon simple configurations, the officially provided <code>Maven</code> plugin <code>sofa-ark-plugin-maven-plugin</code> can package common Java projects into a standard-format <code>Ark Plugin</code>. The coordinates of <code>Maven</code> plugin are:</p><pre><code class=language-xml>&lt;plugin&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;sofa-ark-plugin-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${sofa.ark.version}&lt;/version&gt;
&lt;/plugin&gt;
</code></pre><blockquote><p><a href=../sofa-ark-ark-plugin>For more information, see the plugin configuration document</a></p></blockquote><h2 id=getting-started>Getting started</h2><p>Based on this sample project, we will describe how to build an <code>Ark plugin</code> step by step.</p><h3 id=create-a-standard-maven-project>Create a Standard Maven Project</h3><p>This is a standard Maven project consisting of two modules:
* The common module: contains the plugin export class</p><ul><li>The plugin module: contains <code>com.alipay.sofa.ark.spi.service.PluginActivator</code> interface implementation class and a plugin service class. The plugin packaging tool <code>sofa-ark-plugin-maven-plugin</code> can be configured in the module&rsquo;s <code>pom.xml</code> file;</li></ul><h3 id=configuring-packaging-plugin>Configuring Packaging Plugin</h3><p>Package the plugin in the <code>pom.xml</code> file according to the following configurations:</p><pre><code class=language-xml>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
            &lt;artifactId&gt;sofa-ark-plugin-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;default-cli&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;ark-plugin&lt;/goal&gt;
                    &lt;/goals&gt;

                    &lt;configuration&gt;

                        &lt;!--can only configure no more than one activator--&gt;
                        &lt;activator&gt;com.alipay.sofa.ark.sample.activator.SamplePluginActivator&lt;/activator&gt;

                        &lt;!-- configure exported class --&gt;
                        &lt;exported&gt;
                            &lt;!-- configure package-level exported class--&gt;
                            &lt;packages&gt;
                                &lt;package&gt;com.alipay.sofa.ark.sample.common&lt;/package&gt;
                            &lt;/packages&gt;

                            &lt;!-- configure class-level exported class --&gt;
                            &lt;classes&gt;
                                &lt;class&gt;com.alipay.sofa.ark.sample.facade.SamplePluginService&lt;/class&gt;
                            &lt;/classes&gt;
                        &lt;/exported&gt;

                        &lt;!--specify destination where ark-plugin will be saved, default saved to ${project.build.directory}--&gt;
                        &lt;outputDirectory&gt;../target&lt;/outputDirectory&gt;

                    &lt;/configuration&gt;
                &lt;/execution&gt;

            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><p>In the sample project, we have configured only a fraction of the items, but they are enough to produce an executable <code>Ark Plugin</code>. The meaning of each configuration item is shown below:
* activator: The entry class of the Ark container startup plugin. At most one activator can be configured. The plugin&rsquo;s <code>activator</code> will generally execute a couple of initializations such as the plugin service publish. In this sample project, the plugin service is published.</p><ul><li><p>Export package: The package-level export class configuration. All classes inside the plugins prefixed with the name of the export package, including the plugin&rsquo;s third-party dependency packages, will be exported;</p></li><li><p>Export class: Configure this to export specified classes with precise class names;</p></li><li><p>outputDirectory: The output directory into which the generated Ark plugin is placed after <code>mvn package</code> is executed;</p></li></ul><p>Note that in the sample project, we have only exported the classes created by the project. In actual use, however, we can also export the third-party packages that the project depends on.</p><h3 id=packaging-installation-publishing-and-introducing>Packaging, Installation, Publishing, and Introducing</h3><p>Like a common project, we can simply use <code>mvn package</code>, <code>mvn install</code>, or <code>mvn deploy</code> to install and publish plugins. Note that the Maven coordinates of <code>Ark Plugin</code> that is published by default will add the <code>classifier=ark-plugin</code>. In this sample project, if we want to use that ark plugin, we need to configure the dependencies as follows:</p><pre><code class=language-xml>&lt;dependency&gt;
     &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
     &lt;artifactId&gt;sample-ark-plugin&lt;/artifactId&gt;
     &lt;classifier&gt;ark-plugin&lt;/classifier&gt;
     &lt;version&gt;${sofa.ark.version}&lt;/version&gt;
 &lt;/dependency&gt;
</code></pre></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>