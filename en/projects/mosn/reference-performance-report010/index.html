<!doctype html><html><head><title>MOSN 0.1.0 performance report · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/mosn/reference-performance-report010/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/mosn/reference-performance-report010/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>MOSN 0.1.0 performance report</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/mosn/reference-performance-report010/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><h2 id=instructions-on-performance-report>Instructions on performance report</h2><p>The following performance report presents the performance comparison data of MOSN 0.1.0 with envoy in terms of pure TCP forwarding for Bolt and HTTP1.x protocols, mainly including QPS, RTT, failure rate, success rate and other indicators.</p><p>It is significant to note the following optimizations in v0.1.0 which are intended to improve the forwarding performance of MOSN.</p><ul><li>For thread model, MOSN uses the worker goroutine pool to handle stream events, and uses two independent goroutines to handle read and write IO separately.</li><li>For single-core forwarding, in the case of specifying <code>P=1</code>, MOSN binds CPU with cores to improve the call execution efficiency of the system and the locality affinity of cache.</li><li>For memory, in the case of binding single core, MOSN uses SLAB-style recycling mechanism to improve reuse and reduce memory copy.</li><li>For IO, MOSN mainly implements optimization by controlling the read/write buffer size, read/write timing, read/write frequency and other parameters.</li></ul><p>The performance test data is as follows:</p><h2 id=tcp-proxy-performance-data>TCP proxy performance data</h2><p>For the same deployment mode, this report compares MOSN 0.1.0 and envoy for the upper-layer protocol Bolt (SOFARPC related protocol) and HTTP1.1 respectively.</p><h3 id=deployment-mode>Deployment mode</h3><p>The pressure test is deployed in a pure proxy mode. The client process accesses the server process through the MOSN process and serves as a forwarding proxy. The client process, MOSN process, and server process run on the machines which belong to different network segments. The network delay of the direct access from the client to server is about 2.5ms.</p><h3 id=client>Client</h3><h4 id=bolt-protocol-send-1k-string>Bolt protocol (send 1K string)</h4><p>The client that sends the Bolt protocol data uses the online pressure generators developed by Ant Financial and deploys the SOFARPC client.</p><p>On the pressure generator performance page, you can see the QPS, success/failure counts, RT and other parameters.</p><h4 id=http1-1-protocol-send-1k-string>HTTP1.1 protocol (send 1K string)</h4><p>Use ApacheBench/2.3. The test instructions are:</p><pre><code class=language-bash>ab -n $RPC -c $CPC -p 1k.txt -T &quot;text/plain&quot; -k http://11.166.161.136:12200/tcp_bench &gt; ab.log.$CPU_IDX &amp;
</code></pre><h3 id=mesh-machine-specifications>Mesh machine specifications</h3><p>The mesh runs in a container where the CPU is an exclusive logical core. The specifications are as follows:</p><table><thead><tr><th>Category</th><th>Information</th></tr></thead><tbody><tr><td>OS</td><td>3.10.0-327.ali2008.alios7.x86_64</td></tr><tr><td>CPU</td><td>Intel&reg; Xeon&reg; CPU E5-2650 v2 @ 2.60GHz X 1</td></tr></tbody></table><h3 id=upstream-machine-specifications>Upstream machine specifications</h3><table><thead><tr><th>Category</th><th>Information</th></tr></thead><tbody><tr><td>OS</td><td>2.6.32-431.17.1.el6.FASTSOCKET</td></tr><tr><td>CPU</td><td>Intel&reg; Xeon&reg; CPU E5620 @ 2.40GHz X 16</td></tr></tbody></table><h3 id=bolt-protocol-test-result>Bolt protocol test result</h3><h4 id=performance-data>Performance data</h4><table><thead><tr><th>Indicators</th><th>MOSN</th><th>Envoy</th></tr></thead><tbody><tr><td>QPS</td><td>103500</td><td>104000</td></tr><tr><td>RT</td><td>16.23ms</td><td>15.88ms</td></tr><tr><td>MEM</td><td>31m</td><td>18m</td></tr><tr><td>CPU</td><td>100%</td><td>100%</td></tr></tbody></table><h4 id=conclusion>Conclusion</h4><p>For single-core TCP forwarding, there is little difference between MOSN 0.1.0 and Envoy 1.7 in terms of performance in the condition with full load, such as QPS, RTT and success/failure counts. We will continue to optimize in the subsequent versions.</p><h3 id=http-1-1-test-result>HTTP/1.1 test result</h3><p>Since the HTTP/1.1 request response model is PING-PONG, QPS is positively correlated with the number of concurrences. The following tests are performed for different concurrence counts.</p><h4 id=concurrences-20>Concurrences - 20</h4><table><thead><tr><th>Indicators</th><th>MOSN</th><th>Envoy</th></tr></thead><tbody><tr><td>QPS</td><td>5600</td><td>5600</td></tr><tr><td>RT (mean)</td><td>3.549ms</td><td>3.545ms</td></tr><tr><td>RT (P99)</td><td>4ms</td><td>4ms</td></tr><tr><td>RT (P98)</td><td>4ms</td><td>4ms</td></tr><tr><td>RT (P95)</td><td>4ms</td><td>4ms</td></tr><tr><td>MEM</td><td>24m</td><td>23m</td></tr><tr><td>CPU</td><td>40%</td><td>20%</td></tr></tbody></table><h4 id=concurrences-40>Concurrences - 40</h4><table><thead><tr><th>Indicators</th><th>MOSN</th><th>Envoy</th></tr></thead><tbody><tr><td>QPS</td><td>11150</td><td>11200</td></tr><tr><td>RT (mean)</td><td>3.583ms</td><td>3.565ms</td></tr><tr><td>RT (P99)</td><td>4ms</td><td>4ms</td></tr><tr><td>RT (P98)</td><td>4ms</td><td>4ms</td></tr><tr><td>RT (P95)</td><td>4ms</td><td>4ms</td></tr><tr><td>MEM</td><td>34m</td><td>24m</td></tr><tr><td>CPU</td><td>70%</td><td>40%</td></tr></tbody></table><h4 id=concurrences-200>Concurrences - 200</h4><table><thead><tr><th>Indicators</th><th>MOSN</th><th>Envoy</th></tr></thead><tbody><tr><td>QPS</td><td>29670</td><td>38800</td></tr><tr><td>RT (mean)</td><td>5.715ms</td><td>5.068ms</td></tr><tr><td>RT (P99)</td><td>16ms</td><td>7ms</td></tr><tr><td>RT (P98)</td><td>13ms</td><td>7ms</td></tr><tr><td>RT (P95)</td><td>11ms</td><td>6ms</td></tr><tr><td>MEM</td><td>96m</td><td>24m</td></tr><tr><td>CPU</td><td>100%</td><td>95%</td></tr></tbody></table><h4 id=concurrences-220>Concurrences - 220</h4><table><thead><tr><th>Indicators</th><th>MOSN</th><th>Envoy</th></tr></thead><tbody><tr><td>QPS</td><td>30367</td><td>41070</td></tr><tr><td>RT (mean)</td><td>8.201ms</td><td>5.369ms</td></tr><tr><td>RT (P99)</td><td>20ms</td><td>9ms</td></tr><tr><td>RT (P98)</td><td>19ms</td><td>8ms</td></tr><tr><td>RT (P95)</td><td>16ms</td><td>8ms</td></tr><tr><td>MEM</td><td>100m</td><td>24m</td></tr><tr><td>CPU</td><td>100%</td><td>100%</td></tr></tbody></table><h4 id=conclusion-1>Conclusion</h4><p>When the upper-layer protocol is HTTP/1.X., a certain gap exists between MOSN and Envoy in terms of performance.</p><p>The preliminary conclusion is that in the PING-PONG package delivery model, MOSN cannot merge the read/write system calls. In the scenario where SOFARPC can merge the calls, MOSN&rsquo;s HTTP performance is weaker than that of Envoy because the syscall count significantly increases.</p><p>This problem will be optimized in version 0.2.0.</p><h2 id=appendix>Appendix</h2><h3 id=envoy-version-information>Envoy version information</h3><ul><li>version:1.7</li><li>Tag:1ef23d481a4701ad4a414d1ef98036bd2ed322e7</li></ul><h3 id=envoy-tcp-test-configuration>Envoy TCP test configuration</h3><pre><code class=language-yaml>static_resources:
  listeners:
  - address:
      socket_address:
        address: 0.0.0.0
        port_value: 12200
    filter_chains:
    - filters:
      - name: envoy.tcp_proxy
        config:
          stat_prefix: ingress_tcp
          cluster: sofa_server
  clusters:
  - name: sofa_server
    connect_timeout: 0.25s
    type: static
    lb_policy: round_robin
    hosts:
    - socket_address:
        address: 10.210.168.5
        port_value: 12222
    - socket_address:
        address: 10.210.168.5
        port_value: 12223
    - socket_address:
        address: 10.210.168.5
        port_value: 12224
    - socket_address:
        address: 10.210.168.5
        port_value: 12225
admin:
  access_log_path: &quot;/dev/null&quot;
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 8001
</code></pre></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>