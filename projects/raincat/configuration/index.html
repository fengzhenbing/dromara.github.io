<!doctype html><html><head><title>· dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/>Projects</a>
<a class=navbar-item href=/guides/>Guides</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="Raincat is a strongly consistent distributed transaction framework based on a two-phase commit &#43; local transaction compensation mechanism.">Raincat<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>Main Projects</h4><ul class=list><li class=item><a href=/projects/soul/overview>Soul</a></li><li class=item><a href=/projects/hmily/overview>Hmily</a></li><li class=item><a href=/projects/raincat/overview>Raincat</a></li><li class=item><a href=/projects/myth/overview>Myth</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title></h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/dromara.github.io/edit/master/content/en/projects/raincat/configuration/index.md>Edit</a></div><div class=meta>Update time: 0001-01-01</div></div><article class=typo><h1 id=configuration>Configuration</h1><h2 id=txmanager-configuration>TxManager configuration</h2><ul><li><code>application.properties</code> is the configuration file that can be used to configure the http port of <code>tmManager</code>, Redis and Netty related configuration. Notice: Due to <code>tmManage</code> register itself, the port of http(<code>server.port</code>) should be consistent with Eureka port.</li></ul><pre><code class=language-java>server.port=8761   // port of txManager
tx.manager.netty.port=9998  //Tcp port exposed to business part
tx.manager.netty.serialize=kryo  //Serialization of Netty, need to be consistent with business part.
</code></pre><ul><li><p>The <code>bootstrap.yml</code> is mainly configure the properities of Eureka, like <code>renew</code> time, registed address.</p></li><li><p>Deploy cluster configuration</p><ul><li>The <code>server.port</code> can be modified in <code>application.properities</code>, such as the first node is <code>server.port=8761 tx.manager.netty.port=9998</code>, the second node is <code>server.port=8762 tx.manager.netty.port=9999</code>.</li><li>The <code>eureka:client:serviceUrl:defaultZone:</code> can be modified in <code>boostrap.yml</code>, and then bootstrap the following nodes <code>http://localhost:8761/eureka/</code>and <code>http://localhost:8762/eureka/</code>.</li></ul></li></ul><h2 id=business-side-configuration>Business side configuration：</h2><p><code>@TxTransaction</code> is an an annotation of distributed transaction aspect(AOP), and need to be added when the business side&rsquo;s service handle distributed transactions.</p><ul><li><code>applicationContext.xml</code> configuration:</li></ul><pre><code class=language-xml>&lt;!-- Aspect AOP configuration, whether use AOP or not--&gt;
   &lt;aop:aspectj-autoproxy expose-proxy=&quot;true&quot;/&gt;
   &lt;!--Package used for scanning distributed transactions--&gt;
   &lt;context:component-scan base-package=&quot;com.raincat.*&quot;/&gt;
   &lt;!--Bootstrap configuration--&gt;
   &lt;bean id=&quot;txTransactionBootstrap&quot; class=&quot;com.raincat.core.bootstrap.TxTransactionBootstrap&quot;&gt;
       &lt;property name=&quot;txManagerUrl&quot; value=&quot;http://192.168.1.66:8761&quot;/&gt;
       &lt;property name=&quot;serializer&quot; value=&quot;kryo&quot;/&gt;
       &lt;property name=&quot;nettySerializer&quot; value=&quot;kryo&quot;/&gt;
       &lt;property name=&quot;blockingQueueType&quot; value=&quot;Linked&quot;/&gt;
       &lt;property name=&quot;compensation&quot; value=&quot;true&quot;/&gt;
       &lt;property name=&quot;compensationCacheType&quot; value=&quot;db&quot;/&gt;
       &lt;property name=&quot;txDbConfig&quot;&gt;
           &lt;bean class=&quot;com.raincat.common.config.TxDbConfig&quot;&gt;
               &lt;property name=&quot;url&quot;
                         value=&quot;jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;amp;characterEncoding=utf8&quot;/&gt;
               &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
               &lt;property name=&quot;password&quot; value=&quot;password&quot;/&gt;
               &lt;property name=&quot;username&quot; value=&quot;xiaoyu&quot;/&gt;
           &lt;/bean&gt;
       &lt;/property&gt;
   &lt;/bean&gt;

</code></pre><ul><li><code>TxTransactionBootstrap</code> configuration:</li></ul><pre><code class=language-xml>&lt;!-- Configure the IP:PORT of http request in TxManager, and this file
  need to be changed when TxManager configuration need change. --&gt;
   &lt;property name=&quot;txManagerUrl&quot; value=&quot;http://192.168.1.66:8761&quot;/&gt;

   &lt;!-- Serilization way used in communicating with txManager, spi expansion support kroy，hessian and protostuff, which kroy is recommended. --&gt;
   &lt;property name=&quot;nettySerializer&quot; value=&quot;kryo&quot;/&gt;

   &lt;!-- The type of queue in thread pool, spi expansion support Linked, Array, Synchronous. --&gt;
   &lt;property name=&quot;blockingQueueType&quot; value=&quot;Linked&quot;/&gt;

   &lt;!-- The rejection strategy in thread pool, spi expansion support Abort, Blocking, CallerRuns, Discarded, Rejected.--&gt;
   &lt;property name=&quot;rejectPolicy&quot; value=&quot;Abort&quot;/&gt;

   &lt;!-- Use local compensation, default is opened--&gt;
   &lt;property name=&quot;compensation&quot; value=&quot;true&quot;/&gt;  
   &lt;!-- Local serilization way and support spi expansion such as java, kroy, hessian, protostuff.(kyro is recommended) --&gt;
   &lt;property name=&quot;serializer&quot; value=&quot;kryo&quot;/&gt;
</code></pre><ul><li><p>Local data storage configuration and detailed explanation are as follows. (spi extension supports DB, Redis, Zookeeper, Mongodb, File), please refer to the sample project configuration for details.</p><ol><li>The local data storage can be database, which is able to support Mysql, Oracle and sqlServer. When the mode is cluster, the database can create the table automatically, and the table name is the <code>tx_transaction_{module name}</code>. Every module should be configured the same compensation way. Please use one database if you use DB to storage data.</li></ol></li></ul><pre><code class=language-xml>   &lt;!-- compensation type --&gt;
          &lt;property name=&quot;compensationCacheType&quot; value=&quot;db&quot;/&gt;
          &lt;property name=&quot;txDbConfig&quot;&gt;
              &lt;bean class=&quot;com.raincat.common.config.TxDbConfig&quot;&gt;
                  &lt;!-- Url of DB --&gt;
                  &lt;property name=&quot;url&quot;
                            value=&quot;jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;amp;characterEncoding=utf8&quot;/&gt;
                  &lt;!-- Name of DB driver --&gt;          
                  &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
                  &lt;property name=&quot;password&quot; value=&quot;1234567&quot;/&gt;
                  &lt;property name=&quot;username&quot; value=&quot;xiaoyu&quot;/&gt;
              &lt;/bean&gt;
          &lt;/property&gt;
  
</code></pre><ol><li>The local data storage can be Redis, which is recommended when the business mode is cluster. Please refer to <code>com.happylifeplat.transaction.core.config.TxRedisConfig</code> for more information.</li></ol><pre><code class=language-xml>  &lt;!-- The compensation type is Redis --&gt;
       &lt;property name=&quot;compensationCacheType&quot; value=&quot;redis&quot;/&gt;
       &lt;property name=&quot;txRedisConfig&quot;&gt;
          &lt;bean class=&quot;com.raincat.common.config.TxRedisConfig&quot;&gt;
            &lt;!--redis host--&gt;
            &lt;property name=&quot;hostName&quot;  value=&quot;192.168.1.78&quot;/&gt;
            &lt;!--redis port--&gt;
            &lt;property name=&quot;port&quot; value=&quot;6379&quot;/&gt;
            &lt;!-- Configure the Redis password if necessary.--&gt;
            &lt;property name=&quot;password&quot; value=&quot;&quot;/&gt;    
         &lt;/bean&gt;
      &lt;/property&gt;
</code></pre><ol><li>The local data storage can be Zookeeper, which is recommended when the business mode is cluster.<br></li></ol><pre><code class=language-xml>  &lt;!-- The compensation type is Zookeeper --&gt;
        &lt;property name=&quot;compensationCacheType&quot; value=&quot;zookeeper&quot;/&gt;
        &lt;property name=&quot;txZookeeperConfig&quot;&gt;
            &lt;bean class=&quot;com.raincat.common.config.TxZookeeperConfig&quot;&gt;
                &lt;!-- zookeeper host：port --&gt;
                &lt;property name=&quot;host&quot;  value=&quot;192.168.1.66:2181&quot;/&gt;
                &lt;!-- zookeeper session time out duration --&gt;
                &lt;property name=&quot;sessionTimeOut&quot; value=&quot;2000&quot;/&gt;
                &lt;!--zookeeper root path -&gt;
                &lt;property name=&quot;rootPath&quot; value=&quot;/tx&quot;/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
</code></pre><ol><li>The local data storage can be Mongodb, which can be adopted when the business mode is single node. The set will be created automatically, which named <code>tx_transaction_{module name}</code>. Mongodb connection is adopted by <code>Sha1</code> recommended in version 3.4.0, ranther than <code>CR</code> mode. By the way, you should open the anthorization of Mongodb.</li></ol><pre><code class=language-xml>  &lt;!-- The compensation type is Mongodb--&gt;
          &lt;property name=&quot;compensationCacheType&quot; value=&quot;mongodb&quot;/&gt;
           &lt;property name=&quot;txMongoConfig&quot;&gt;
              &lt;bean class=&quot;com.raincat.common.config.TxMongoConfig&quot;&gt;
                  &lt;!-- The URL of Mongodb --&gt;
                  &lt;property name=&quot;mongoDbUrl&quot;  value=&quot;192.168.1.78:27017&quot;/&gt;
                  &lt;!-- The DB name of Mongodb--&gt;
                  &lt;property name=&quot;mongoDbName&quot; value=&quot;happylife&quot;/&gt;
                  &lt;!-- The user name of Mongodb--&gt;
                  &lt;property name=&quot;mongoUserName&quot; value=&quot;xiaoyu&quot;/&gt;
                  &lt;!-- The password of Mongodb --&gt;
                  &lt;property name=&quot;mongoUserPwd&quot; value=&quot;123456&quot;/&gt;
              &lt;/bean&gt;
          &lt;/property&gt;
</code></pre><ol><li><p>The local data storage can be File, which can be adopted when the business mode is single node. The file name should be <code>TX_{prefix configuration}_{module name}</code>.</p><pre><code class=language-xml> &lt;!-- The compensation type is file --&gt;
       &lt;property name=&quot;compensationCacheType&quot; value=&quot;file&quot;/&gt;
       &lt;property name=&quot;txFileConfig&quot;&gt;
              &lt;bean class=&quot;com.raincat.common.config.TxFileConfig&quot;&gt;
                  &lt;!-- Specify the file name if necessary, default is current path. --&gt;
                  &lt;property name=&quot;path&quot;  value=&quot;&quot;/&gt;
                  &lt;!-- Specify the file prefix, generate the file name. --&gt;
                  &lt;property name=&quot;prefix&quot; value=&quot;consume&quot;/&gt;
              &lt;/bean&gt;
        &lt;/property&gt;
</code></pre></li></ol></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>